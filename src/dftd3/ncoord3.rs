use ndarray::{s, Array, Array1, ArrayView1, Array3};
use crate::model::{Molecule};
use nalgebra::{Matrix3xX, Vector3};
use std::ops::{AddAssign, SubAssign};
use crate::auxliary_functions::spread;

const KCN: f64 = 16.0; // Steepness of counting function

pub fn get_coordination_number3(
    mol: &mut Molecule, // Molecular structure data
    trans: &Matrix3xX<f64>, // Lattice points
    cutoff: f64, // Real space cutoff
    rcov: ArrayView1<f64>, // Covalent radius
) -> () {
    let cutoff2 = cutoff.powi(2);

    // Parallelise this loop
    for (iat, (izp, xyz_i)) in mol.atomlist.identifier.iter().zip(mol.atomlist.xyz.iter()).enumerate() {
        for (jat, (jzp, xyz_j)) in mol.atomlist.identifier[..=iat].iter().zip(mol.atomlist.xyz[..=iat].iter()).enumerate() {
            for trans_itr in trans.column_iter() {
                let rij: Vector3<f64> = (xyz_i - xyz_j) - trans_itr;
                let r2 = rij.norm_squared();

                if r2 > cutoff2 || r2 < 1.0e-12 {
                    continue;
                }
                let r1 = r2.sqrt();

                let rc = rcov[*izp] + rcov[*jzp];

                let countf = exp_count(KCN, r1, rc);

                mol.atomlist.coord_number[iat] += countf;
                if iat != jat {
                    mol.atomlist.coord_number[jat] += countf
                }
            }
        }
    }
}

pub fn get_coordination_number3_grad(
    mol: &mut Molecule, // Molecular structure data
    trans: &Matrix3xX<f64>, // Lattice points
    cutoff: f64, // Real space cutoff
    rcov: ArrayView1<f64>, // Covalent radius
) -> (Array3<f64>, Array3<f64>) {
    let mut dcndr: Array3<f64> = Array::zeros((mol.n_atoms, mol.n_atoms, 3));
    let mut dcndl: Array3<f64> = Array::zeros((mol.n_atoms, 3, 3));
    let cutoff2 = cutoff.powi(2);

    // Parallelise this loop
    for (iat, (izp, xyz_i)) in mol.atomlist.identifier.iter().zip(mol.atomlist.xyz.iter()).enumerate() {
        for (jat, (jzp, xyz_j)) in mol.atomlist.identifier[..=iat].iter().zip(mol.atomlist.xyz[..=iat].iter()).enumerate() {
            for trans_itr in trans.column_iter() {
                let rij: Vector3<f64> = (xyz_i - xyz_j) - trans_itr;
                let r2 = rij.norm_squared();

                if r2 > cutoff2 || r2 < 1.0e-12 {
                    continue;
                }
                let r1 = r2.sqrt();

                let rc = rcov[*izp] + rcov[*jzp];

                let rij: Array1<f64> = Array::from_iter(rij.iter().map(|x| *x));
                let countf =  exp_count(KCN, r1, rc);
                let countd: Array1<f64> = dexp_count(KCN, r1, rc) * (&rij/r1);

                mol.atomlist.coord_number[iat] += countf;
                if iat != jat {
                    mol.atomlist.coord_number[jat] += countf
                }

                dcndr.slice_mut(s![iat, iat, ..]).add_assign(&countd);
                dcndr.slice_mut(s![jat, jat, ..]).sub_assign(&countd);
                dcndr.slice_mut(s![jat, iat, ..]).add_assign(&countd);
                dcndr.slice_mut(s![iat, jat, ..]).sub_assign(&countd);

                let sigma = &spread(&countd, 1, 3) * &spread(&rij, 0, 3);

                dcndl.slice_mut(s![iat, .., ..]).add_assign(&sigma);
                if iat != jat {
                    dcndl.slice_mut(s![jat, .., ..]).add_assign(&sigma);
                }
            }
        }
    }

    (dcndr, dcndl)
}

/// Exponential counting function for coordination number contributions.
fn exp_count(
    k: f64, // Steepness of the counting function.
    r: f64, // Current distance.
    r0: f64, // Cutoff radius.
) -> f64 {

    1.0/(1.0 + (-k*(r0/r - 1.0)).exp())
}

/// Derivative of the counting function w.r.t. the distance.
fn dexp_count(
    k: f64, // Steepness of the counting function.
    r: f64, // Current distance.
    r0: f64, // Cutoff radius.
) -> f64 {
    let expterm = (-k*(r0/r - 1.0)).exp();

    (-k*r0*expterm)/(r.powi(2)*((expterm + 1.0).powi(2)))
}

#[cfg(test)]
mod tests {
    use crate::test::get_uracil;
    use crate::cutoff::{RealspaceCutoffBuilder, get_lattice_points_cutoff};
    use crate::dftd3::model3::D3Model;
    use crate::dftd3::ncoord3::{get_coordination_number3, get_coordination_number3_grad};
    use ndarray::{array, Array, Array1, Array3};

    #[test]
    fn coordination_number3_cn() -> () {
        let mut mol = get_uracil();
        let cutoff = RealspaceCutoffBuilder::new().build();
        let lattr = get_lattice_points_cutoff(&mol.periodic, &mol.lattice, cutoff.cn);
        let disp = D3Model::from_molecule(&mol, None);
        get_coordination_number3(&mut mol, &lattr, cutoff.cn, disp.rcov.view());
        let cn: Array1<f64> = Array::from(mol.atomlist.coord_number);

        let cn_ref: Array1<f64> = array![
            3.1567590992312762,  3.1560018857752477,  3.1550010011210610,  3.1304362806896302,
            3.1707199519035965,  3.1609559664373026,  1.0861922657699317,  1.0756513374631611,
            1.0066987501747720,  1.0064104723725322,  1.0032876467422569,  1.0025228112016256,
            1.0032976242538356,  3.1560929949055225,  1.0861585610067523,  3.1567673297351191,
            3.1548745508212774,  1.0025134407499270,  3.1611720358517821,  3.1301093967413234,
            3.1707959092265297,  1.0064313621044743,  1.0066677696582491,  1.0757557322804825,
        ];

        println!("{:?}", cn);

        assert!(cn.abs_diff_eq(&cn_ref, 1e-14));
    }

    #[test]
    fn coordination_number3_derivative() -> () {
        let mut mol = get_uracil();
        let cutoff = RealspaceCutoffBuilder::new().build();
        let lattr = get_lattice_points_cutoff(&mol.periodic, &mol.lattice, cutoff.cn);
        let disp = D3Model::from_molecule(&mol, None);
        let (dcndr, dcndl) = get_coordination_number3_grad(&mut mol, &lattr, cutoff.cn, disp.rcov.view());
        let cn: Array1<f64> = Array::from(mol.atomlist.coord_number);

        let cn_ref: Array1<f64> = array![
            3.1567590992312762,  3.1560018857752472,  3.1550010011210610,  3.1304362806896293,
            3.1707199519035960,  3.1609559664373035,  1.0861922657699317,  1.0756513374631613,
            1.0066987501747720,  1.0064104723725324,  1.0032876467422569,  1.0025228112016253,
            1.0032976242538358,  3.1560929949055225,  1.0861585610067523,  3.1567673297351186,
            3.1548745508212779,  1.0025134407499270,  3.1611720358517821,  3.1301093967413225,
            3.1707959092265292,  1.0064313621044743,  1.0066677696582491,  1.0757557322804825,
        ];

        let dcndr_ref_array: [[[f64; 24]; 24]; 3] = [
            [
                [  0.2240296437037794, -0.0026671512580208,  0.0294712234311513,  0.0116867086546215,
                    0.1703005234681177,  0.0097204591495798, -0.0017618024850827,  0.0005980527318821,
                    0.0000227037704259,  0.0120922032670939, -0.0072507631849020,  0.0000021832288861,
                    0.0000072187955381,  0.0005258792393907,  0.0001060189088188,  0.0006063787745889,
                    0.0001542148787643,  0.0000000907842485,  0.0001937480384122,  0.0000782515444305,
                    0.0001178898777868,  0.0000081560403790,  0.0000022100517889,  0.0000152459958798,],
                [  0.0026671512580208,  0.1712744987052623,  0.0049964493995500,  0.1177546529175106,
                    0.0235759523816021,  0.0911866546130349, -0.0165745185551536,  0.0001621375388131,
                    0.0000933861518454,  0.0000674372839646, -0.0572387851841298,  0.0028763136651300,
                    0.0000049089094795,  0.0002954255463110,  0.0000201249734938,  0.0001610001491723,
                    0.0005219248102691,  0.0000052367264691,  0.0001095840329678,  0.0003367942998184,
                    0.0002079250866432,  0.0000046584846368,  0.0000109782944019,  0.0000291059214113,],
                [ -0.0294712234311513, -0.0049964493995500,  0.1124636395179976,  0.0079265380589049,
                    0.1437993446597296,  0.0060664872086905, -0.0001956209539615,  0.0005396871153163,
                    0.0160177804880706,  0.0000118503895817, -0.0098183898198032, -0.0189310583573521,
                    0.0000002490866616,  0.0000376494631324,  0.0000074132571125,  0.0000601340471191,
                    0.0000873298248517, -0.0000016667249119,  0.0001304024843594,  0.0004667754526240,
                    0.0005740994238495,  0.0000060489770348,  0.0000173357477076,  0.0001289225199816,],
                [ -0.0116867086546215, -0.1177546529175106, -0.0079265380589049, -0.0436903463538486,
                    0.0033795933913038, -0.0164248418311222, -0.0000851559183673,  0.0717820919686086,
                    0.0407538768969869, -0.0000014262603373, -0.0000710464938859, -0.0067464937592095,
                    -0.0000005578252898, -0.0000064226323155,  0.0000050942864101,  0.0000317277852033,
                    -0.0000230210789063, -0.0000015412935784,  0.0002136738638684,  0.0000216126147383,
                    0.0005845621652494,  0.0000131118033709, -0.0000003718376686,  0.0002530874321298,],
                [ -0.1703005234681177, -0.0235759523816021, -0.1437993446597296, -0.0033795933913038,
                    -0.3465939591419632, -0.0063833924030530, -0.0005245729709779,  0.0027269175543452,
                    0.0014259437465377, -0.0037118645660771, -0.0000313173718633, -0.0000642567071591,
                    -0.0000015231862076, -0.0000301997531062,  0.0000208949543911,  0.0000804072361729,
                    -0.0000284956071424, -0.0000014409511666,  0.0006039814913343, -0.0000106539096276,
                    0.0002584587379369,  0.0000496421947986, -0.0000007726884211,  0.0000836989580752,],
                [ -0.0097204591495798, -0.0911866546130349, -0.0060664872086905,  0.0164248418311222,
                    0.0063833924030530, -0.0628325966984476, -0.0916295822371819,  0.0897808544071969,
                    0.0000265024840960,  0.0220503049673542, -0.0000595126823087, -0.0000083493815806,
                    -0.0000019743568042,  0.0000063797206004,  0.0001402841518869,  0.0005062251710511,
                    -0.0000098394943789, -0.0000011172164531,  0.0003816374638547,  0.0000121543186419,
                    0.0001007994935765,  0.0000208171585364,  0.0000002213692012,  0.0000169647013937,],
                [  0.0017618024850827,  0.0165745185551536,  0.0001956209539615,  0.0000851559183673,
                    0.0005245729709779,  0.0916295822371819,  0.1117436315020499,  0.0000271944485740,
                    0.0000016071102793,  0.0005652730101402, -0.0001351043723970,  0.0000011101840230,
                    0.0000111306155970,  0.0002156974343517,  0.0000475776953757,  0.0001331253053619,
                    0.0000455305584121,  0.0000009851158779,  0.0000261865647661,  0.0000126672520810,
                    0.0000144469130962,  0.0000017407050036,  0.0000006111262271,  0.0000025987145553,],
                [ -0.0005980527318821, -0.0001621375388131, -0.0005396871153163, -0.0717820919686086,
                    -0.0027269175543452, -0.0897808544071969, -0.0000271944485740, -0.1662454379184225,
                    -0.0002226464308213, -0.0003929543953439, -0.0000023189377825, -0.0000046712887159,
                    -0.0000005423630268, -0.0000088453347030, -0.0000027260323732, -0.0000174958180986,
                    -0.0000063526806286, -0.0000004110893320,  0.0000192001764616, -0.0000068369207843,
                    -0.0000061178658718,  0.0000154478861061, -0.0000004667226665,  0.0000092356638943,],
                [ -0.0000227037704259, -0.0000933861518454, -0.0160177804880706, -0.0407538768969869,
                    -0.0014259437465377, -0.0000265024840960, -0.0000016071102793,  0.0002226464308213,
                    -0.0581237311834156, -0.0000001936746466, -0.0000009998817211, -0.0000362447308924,
                    -0.0000000536601988, -0.0000006874622921,  0.0000001387323139,  0.0000003302882239,
                    -0.0000016406041222, -0.0000001259592843,  0.0000046329126990, -0.0000018729221321,
                    0.0000124998285491,  0.0000005448097282, -0.0000001963644011,  0.0000192917221815,],
                [ -0.0120922032670939, -0.0000674372839646, -0.0000118503895817,  0.0000014262603373,
                    0.0037118645660771, -0.0220503049673542, -0.0005652730101402,  0.0003929543953439,
                    0.0000001936746466, -0.0306366136307491, -0.0000007879151029, -0.0000001716705897,
                    -0.0000002031453064, -0.0000013668196755,  0.0000142962633969,  0.0000171194108260,
                    -0.0000007889543200, -0.0000000834793115,  0.0000113912118218,  0.0000001785354136,
                    0.0000025993250400,  0.0000010729570765, -0.0000000010697643,  0.0000007617414759,],
                [  0.0072507631849020,  0.0572387851841298,  0.0098183898198032,  0.0000710464938859,
                    0.0000313173718633,  0.0000595126823087,  0.0001351043723970,  0.0000023189377825,
                    0.0000009998817211,  0.0000007879151029,  0.0747086891071711,  0.0000197164345442,
                    0.0000005027443056,  0.0000142968752783,  0.0000011735221857,  0.0000056442486191,
                    0.0000313568983501,  0.0000011396349132,  0.0000034910644671,  0.0000134245907372,
                    0.0000064712359027,  0.0000002291945244,  0.0000007542858818,  0.0000014625335654,],
                [ -0.0000021832288861, -0.0028763136651300,  0.0189310583573521,  0.0067464937592095,
                    0.0000642567071591,  0.0000083493815806, -0.0000011101840230,  0.0000046712887159,
                    0.0000362447308924,  0.0000001716705897, -0.0000197164345442,  0.0229458919626799,
                    0.0000000293298501,  0.0000014702864192,  0.0000003789612514,  0.0000018720851382,
                    0.0000042009978482, -0.0000000119365607,  0.0000035779920142,  0.0000180251446831,
                    0.0000160468269931,  0.0000002588653739,  0.0000013588924651,  0.0000067621342880,],
                [ -0.0000072187955381, -0.0000049089094795, -0.0000002490866616,  0.0000005578252898,
                    0.0000015231862076,  0.0000019743568042, -0.0000111306155970,  0.0000005423630268,
                    0.0000000536601988,  0.0000002031453064, -0.0000005027443056, -0.0000000293298501,
                    0.0517967081662969,  0.0397373557597329,  0.0004249848973061,  0.0096844371987635,
                    0.0018635341533501, -0.0000078663272223,  0.0000612098944662,  0.0000278835091792,
                    0.0000215477291865,  0.0000009608000911,  0.0000002534449689,  0.0000015920510730,],
                [ -0.0005258792393907, -0.0002954255463110, -0.0000376494631324,  0.0000064226323155,
                    0.0000301997531062, -0.0000063797206004, -0.0002156974343517,  0.0000088453347030,
                    0.0000006874622921,  0.0000013668196755, -0.0000142968752783, -0.0000014702864192,
                    -0.0397373557597329,  0.2066125099147730,  0.0918750160997323,  0.0073497694209013,
                    -0.0019801654235335, -0.0071131299631030,  0.1114704304989752,  0.0294161893254338,
                    0.0161619573483356,  0.0000994119567611,  0.0000086955577727,  0.0001109674166220,],
                [ -0.0001060189088188, -0.0000201249734938, -0.0000074132571125, -0.0000050942864101,
                    -0.0000208949543911, -0.0001402841518869, -0.0000475776953757,  0.0000027260323732,
                    -0.0000001387323139, -0.0000142962633969, -0.0000011735221857, -0.0000003789612514,
                    -0.0004249848973061, -0.0918750160997323, -0.0686003663143978, -0.0007661616739333,
                    -0.0003259606309921, -0.0000039339556223,  0.0247966616234350, -0.0000367455010899,
                    0.0000348464465829,  0.0003557213433708, -0.0000006933995990,  0.0000065701047521,],
                [ -0.0006063787745889, -0.0001610001491723, -0.0000601340471191, -0.0000317277852033,
                    -0.0000804072361729, -0.0005062251710511, -0.0001331253053619,  0.0000174958180986,
                    -0.0000003302882239, -0.0000171194108260, -0.0000056442486191, -0.0000018720851382,
                    -0.0096844371987635, -0.0073497694209013,  0.0007661616739333, -0.0757631461495574,
                    -0.1141823259942253, -0.0000738659291324,  0.0065843989526245, -0.0050249453485660,
                    0.0410838689888972,  0.0134777015811170, -0.0000097702827806,  0.0002363055116177,],
                [ -0.0001542148787643, -0.0005219248102691, -0.0000873298248517,  0.0000230210789063,
                    0.0000284956071424,  0.0000098394943789, -0.0000455305584121,  0.0000063526806286,
                    0.0000016406041222,  0.0000007889543200, -0.0000313568983501, -0.0000042009978482,
                    -0.0018635341533501,  0.0019801654235335,  0.0003259606309921,  0.1141823259942253,
                    0.2652547727967142, -0.0545788936058071,  0.0172180576002114,  0.0054929932811223,
                    0.1776269077774396,  0.0000333695611272,  0.0050646567386746,  0.0005471830975423,],
                [ -0.0000000907842485, -0.0000052367264691,  0.0000016667249119,  0.0000015412935784,
                    0.0000014409511666,  0.0000011172164531, -0.0000009851158779,  0.0000004110893320,
                    0.0000001259592843,  0.0000000834793115, -0.0000011396349132,  0.0000000119365607,
                    0.0000078663272223,  0.0071131299631030,  0.0000039339556223,  0.0000738659291324,
                    0.0545788936058071,  0.0697067599526467,  0.0000237987759264,  0.0077779612535801,
                    0.0000967830568740,  0.0000004858829781,  0.0000254361311742,  0.0000056586821370,],
                [ -0.0001937480384122, -0.0001095840329678, -0.0001304024843594, -0.0002136738638684,
                    -0.0006039814913343, -0.0003816374638547, -0.0000261865647661, -0.0000192001764616,
                    -0.0000046329126990, -0.0000113912118218, -0.0000034910644671, -0.0000035779920142,
                    -0.0000612098944662, -0.1114704304989752, -0.0247966616234350, -0.0065843989526245,
                    -0.0172180576002114, -0.0000237987759264, -0.1507108429972169, -0.0659854176995265,
                    -0.0027156840186140,  0.0608648831080149, -0.0000478286408934,  0.0190292688964674,],
                [ -0.0000782515444305, -0.0003367942998184, -0.0004667754526240, -0.0000216126147383,
                    0.0000106539096276, -0.0000121543186419, -0.0000126672520810,  0.0000068369207843,
                    0.0000018729221321, -0.0000001785354136, -0.0000134245907372, -0.0000180251446831,
                    -0.0000278835091792, -0.0294161893254338,  0.0000367455010899,  0.0050249453485660,
                    -0.0054929932811223, -0.0077779612535801,  0.0659854176995265,  0.1104882419541946,
                    0.0093984786835114,  0.0000650462337479, -0.0175748096907758,  0.0912079655484681,],
                [ -0.0001178898777868, -0.0002079250866432, -0.0005740994238495, -0.0005845621652494,
                    -0.0002584587379369, -0.0001007994935765, -0.0000144469130962,  0.0000061178658718,
                    -0.0000124998285491, -0.0000025993250400, -0.0000064712359027, -0.0000160468269931,
                    -0.0000215477291865, -0.0161619573483356, -0.0000348464465829, -0.0410838689888972,
                    -0.1776269077774396, -0.0000967830568740,  0.0027156840186140, -0.0093984786835114,
                    -0.2431571191802620,  0.0096481166660696, -0.0110658048689766,  0.0018589560836097,],
                [ -0.0000081560403790, -0.0000046584846368, -0.0000060489770348, -0.0000131118033709,
                    -0.0000496421947986, -0.0000208171585364, -0.0000017407050036, -0.0000154478861061,
                    -0.0000005448097282, -0.0000010729570765, -0.0000002291945244, -0.0000002588653739,
                    -0.0000009608000911, -0.0000994119567611, -0.0003557213433708, -0.0134777015811170,
                    -0.0000333695611272, -0.0000004858829781, -0.0608648831080149, -0.0000650462337479,
                    -0.0096481166660696, -0.0847931218048907, -0.0000007836517849, -0.0001249119432589,],
                [ -0.0000022100517889, -0.0000109782944019, -0.0000173357477076,  0.0000003718376686,
                    0.0000007726884211, -0.0000002213692012, -0.0000006111262271,  0.0000004667226665,
                    0.0000001963644011,  0.0000000010697643, -0.0000007542858818, -0.0000013588924651,
                    -0.0000002534449689, -0.0000086955577727,  0.0000006933995990,  0.0000097702827806,
                    -0.0050646567386746, -0.0000254361311742,  0.0000478286408934,  0.0175748096907758,
                    0.0110658048689766,  0.0000007836517849,  0.0241078679604180,  0.0005388803829503,],
                [ -0.0000152459958798, -0.0000291059214113, -0.0001289225199816, -0.0002530874321298,
                    -0.0000836989580752, -0.0000169647013937, -0.0000025987145553, -0.0000092356638943,
                    -0.0000192917221815, -0.0000007617414759, -0.0000014625335654, -0.0000067621342880,
                    -0.0000015920510730, -0.0001109674166220, -0.0000065701047521, -0.0002363055116177,
                    -0.0005471830975423, -0.0000056586821370, -0.0190292688964674, -0.0912079655484681,
                    -0.0018589560836097,  0.0001249119432589, -0.0005388803829503, -0.1139855738708123,],
            ],
            [
                [ -0.1702839441475497, -0.0073418617839781, -0.1409351571350300, -0.0101351537236347,
                    -0.0177859099108560,  0.0038047323036814,  0.0015388575069002,  0.0000421479105910,
                    -0.0000196951303096,  0.0107380523148671, -0.0082598997971150, -0.0000847653937497,
                    -0.0000142224722829, -0.0006892741752102, -0.0000008280109124, -0.0002658911272598,
                    -0.0004698150295513, -0.0000141328160446, -0.0000999939978592, -0.0001526818320986,
                    -0.0001154423139505, -0.0000024508648260, -0.0000063770696233, -0.0000141815992975,],
                [  0.0073418617839781,  0.1706098303943347, -0.0041403100255215, -0.0111283035556695,
                    0.0094425927933010,  0.0921282402966891,  0.1107217156176749,  0.0000647347250008,
                    -0.0000254529433596,  0.0000874451668892, -0.0234797463776745, -0.0091713478953396,
                    -0.0000000043713704, -0.0000821648942736,  0.0000073533889838,  0.0000061966241760,
                    -0.0006383194866670, -0.0000247880183301, -0.0000148958420081, -0.0003468621763928,
                    -0.0001043077289742, -0.0000000657493463, -0.0000179284643206, -0.0000158124731105,],
                [  0.1409351571350300,  0.0041403100255215,  0.2593337089762462,  0.0032422298309377,
                    0.1473708635192109,  0.0172649454028004,  0.0004446028174914,  0.0004174838894257,
                    -0.0003036401622301,  0.0000334330698163,  0.0016001434043459, -0.0548310576324242,
                    0.0000007978657697,  0.0000089950687779,  0.0000057810087386,  0.0000230856694815,
                    -0.0001583093418112, -0.0000065965406745,  0.0000079995549080, -0.0005366761089915,
                    -0.0002274485318279,  0.0000009871633163, -0.0000385487653202, -0.0000608293660459,],
                [  0.0101351537236347,  0.0111283035556695, -0.0032422298309377,  0.1423134730596498,
                    0.0094032870236700,  0.0811893259592651,  0.0000740124524537,  0.0764613280466753,
                    -0.0353795721860610,  0.0000744517471869, -0.0000047918755988, -0.0062854251850134,
                    0.0000001074930492, -0.0000055857527129,  0.0000059077319458,  0.0000110758134263,
                    -0.0000527480049230, -0.0000019189053994, -0.0000396403979359, -0.0002470804100643,
                    -0.0006495050298993,  0.0000006411307097, -0.0000140629181993, -0.0002475611212915,],
                [  0.0177859099108560, -0.0094425927933010, -0.1473708635192109, -0.0094032870236700,
                    -0.1445960338531263,  0.0055017196734023,  0.0001590918804186,  0.0010809677542499,
                    -0.0131094999671712,  0.0123690582648120, -0.0000126284929976, -0.0000856433227918,
                    -0.0000010598694936, -0.0000589038144397,  0.0000052459219620, -0.0001564697136891,
                    -0.0000707900222948, -0.0000022619751597, -0.0007056602269992, -0.0001451362932228,
                    -0.0007415726726966, -0.0000239792209253, -0.0000064273393116, -0.0001612509914521,],
                [ -0.0038047323036814, -0.0921282402966891, -0.0172649454028004, -0.0811893259592651,
                    -0.0055017196734023, -0.1468102827696582,  0.0065421232536892, -0.0123514490180229,
                    -0.0000643704137127,  0.0608191145701697, -0.0000470145054247, -0.0000238794003508,
                    -0.0000053738606224, -0.0002632045562998, -0.0000451154558587, -0.0006333294824025,
                    -0.0001200082432817, -0.0000035641360743, -0.0004008187694842, -0.0000858226782223,
                    -0.0001959679960649, -0.0000121785700433, -0.0000036127623565, -0.0000268471094570,],
                [ -0.0015388575069002, -0.1107217156176749, -0.0004446028174914, -0.0000740124524537,
                    -0.0001590918804186, -0.0065421232536892, -0.1202318460743310, -0.0000028314975622,
                    -0.0000013964648301,  0.0001901466934064, -0.0004319001153507, -0.0000048913492244,
                    -0.0000153690255137, -0.0002491150439659, -0.0000087123314359, -0.0000712335020342,
                    -0.0000964655358711, -0.0000053784166391, -0.0000151632502849, -0.0000208458534755,
                    -0.0000138527892794, -0.0000006666359807, -0.0000013737522377, -0.0000023936754239,],
                [ -0.0000421479105910, -0.0000647347250008, -0.0004174838894257, -0.0764613280466753,
                    -0.0010809677542499,  0.0123514490180229,  0.0000028314975622, -0.0664315202254283,
                    -0.0005279717710044,  0.0002906570275078, -0.0000009312732219, -0.0000046619377287,
                    -0.0000003069076831, -0.0000091150696082, -0.0000019857721792, -0.0000357597545328,
                    -0.0000091206848652, -0.0000004756857431, -0.0001930591914914, -0.0000190749087320,
                    -0.0001277384515417, -0.0000210294441122, -0.0000013543034523, -0.0000572102866824,],
                [  0.0000196951303096,  0.0000254529433596,  0.0003036401622301,  0.0353795721860610,
                    0.0131094999671712,  0.0000643704137127,  0.0000013964648301,  0.0005279717710044,
                    0.0493752351855626,  0.0000009637167170,  0.0000000904347122, -0.0000151927440405,
                    0.0000000241080040,  0.0000001803654978,  0.0000004612180895,  0.0000010454333838,
                    -0.0000012600399123, -0.0000000827907642,  0.0000009028766357, -0.0000068852114693,
                    -0.0000163482667826,  0.0000001795403379, -0.0000007061639661, -0.0000197363295590,],
                [ -0.0107380523148671, -0.0000874451668892, -0.0000334330698163, -0.0000744517471869,
                    -0.0123690582648120, -0.0608191145701697, -0.0001901466934064, -0.0002906570275078,
                    -0.0000009637167170, -0.0847225688117345, -0.0000007935261984, -0.0000004871336883,
                    -0.0000005554783457, -0.0000152692605146, -0.0000162109353910, -0.0000455328177402,
                    -0.0000055960782744, -0.0000002586416156, -0.0000200001640869, -0.0000036738200741,
                    -0.0000078635412579, -0.0000010674128946, -0.0000002332042293, -0.0000017042260514,],
                [  0.0082598997971150,  0.0234797463776745, -0.0016001434043459,  0.0000047918755988,
                    0.0000126284929976,  0.0000470145054247,  0.0004319001153507,  0.0000009312732219,
                    -0.0000000904347122,  0.0000007935261984,  0.0305919123409053, -0.0000164036144797,
                    0.0000000987492325, -0.0000004336644699,  0.0000004409031049,  0.0000007388018608,
                    -0.0000173335741655, -0.0000014180885510, -0.0000000842112177, -0.0000079794466874,
                    -0.0000019438485986,  0.0000000134848620, -0.0000007238107672, -0.0000005314637414,],
                [  0.0000847653937497,  0.0091713478953396,  0.0548310576324242,  0.0062854251850134,
                    0.0000856433227918,  0.0000238794003508,  0.0000048913492244,  0.0000046619377287,
                    0.0000151927440405,  0.0000004871336883,  0.0000164036144797,  0.0705176461814432,
                    0.0000000885474052,  0.0000013944638786,  0.0000003906815315,  0.0000013481036571,
                    -0.0000003533261643, -0.0000001272036782,  0.0000012284077910, -0.0000070391423244,
                    -0.0000004826777277,  0.0000000973267055, -0.0000014797503788, -0.0000011748580832,],
                [  0.0000142224722829,  0.0000000043713704, -0.0000007978657697, -0.0000001074930492,
                    0.0000010598694936,  0.0000053738606224,  0.0000153690255137,  0.0000003069076831,
                    -0.0000000241080040,  0.0000005554783457, -0.0000000987492325, -0.0000000885474052,
                    -0.0367663778778262, -0.0282422588631179,  0.0002299666705244,  0.0005858233554281,
                    -0.0092634230336323, -0.0000289660428490, -0.0000115176640891, -0.0000541313124773,
                    -0.0000155877036005, -0.0000000172481442, -0.0000008854999111, -0.0000011557578086,],
                [  0.0006892741752102,  0.0000821648942736, -0.0000089950687779,  0.0000055857527129,
                    0.0000589038144397,  0.0002632045562998,  0.0002491150439659,  0.0000091150696082,
                    -0.0000001803654978,  0.0000152692605146,  0.0000004336644699, -0.0000013944638786,
                    0.0282422588631179, -0.0012368349564739,  0.1007779728213262,  0.0036064609219735,
                    -0.0073316240125437, -0.0095491203328810, -0.0017759841150814, -0.1046333957067665,
                    -0.0117728158028913,  0.0000139524021639, -0.0000960136828089, -0.0000810226454230,],
                [  0.0000008280109124, -0.0000073533889838, -0.0000057810087386, -0.0000059077319458,
                    -0.0000052459219620,  0.0000451154558587,  0.0000087123314359,  0.0000019857721792,
                    -0.0000004612180895,  0.0000162109353910, -0.0000004409031049, -0.0000003906815315,
                    -0.0002299666705244, -0.1007779728213262, -0.1850605429941062, -0.0026516925259808,
                    -0.0005096019567631, -0.0000047543358546, -0.0799154655838374, -0.0001276842669091,
                    -0.0005529620800848, -0.0003109237961683, -0.0000024082365292, -0.0000243823715493,],
                [  0.0002658911272598, -0.0000061966241760, -0.0000230856694815, -0.0000110758134263,
                    0.0001564697136891,  0.0006333294824025,  0.0000712335020342,  0.0000357597545328,
                    -0.0000010454333838,  0.0000455328177402, -0.0000007388018608, -0.0000013481036571,
                    -0.0005858233554281, -0.0036064609219735,  0.0026516925259808, -0.3123465870612716,
                    -0.1348993465721586, -0.0000684307300663, -0.0049225186439236, -0.0174917752480656,
                    -0.1527163495247426, -0.0013847466015856, -0.0000339711255500, -0.0004535828154316,],
                [  0.0004698150295513,  0.0006383194866670,  0.0001583093418112,  0.0000527480049230,
                    0.0000707900222948,  0.0001200082432817,  0.0000964655358711,  0.0000091206848652,
                    0.0000012600399123,  0.0000055960782744,  0.0000173335741655,  0.0000003533261643,
                    0.0092634230336323,  0.0073316240125437,  0.0005096019567631,  0.1348993465721586,
                    0.1162169059182324, -0.0276328127710789,  0.0086465017396558, -0.0039051693410350,
                    -0.0011730555326683,  0.0000166783959649, -0.0132687023942173, -0.0001106491212681,],
                [  0.0000141328160446,  0.0000247880183301,  0.0000065965406745,  0.0000019189053994,
                    0.0000022619751597,  0.0000035641360743,  0.0000053784166391,  0.0000004756857431,
                    0.0000000827907642,  0.0000002586416156,  0.0000014180885510,  0.0000001272036782,
                    0.0000289660428490,  0.0095491203328810,  0.0000047543358546,  0.0000684307300663,
                    0.0276328127710789,  0.0367981454087951,  0.0000119788241818, -0.0005564617531127,
                    0.0000149958674645,  0.0000002435467525, -0.0000175628875156, -0.0000001356203790,],
                [  0.0000999939978592,  0.0000148958420081, -0.0000079995549080,  0.0000396403979359,
                    0.0007056602269992,  0.0004008187694842,  0.0000151632502849,  0.0001930591914914,
                    -0.0000009028766357,  0.0000200001640869,  0.0000000842112177, -0.0000012284077910,
                    0.0000115176640891,  0.0017759841150814,  0.0799154655838374,  0.0049225186439236,
                    -0.0086465017396558, -0.0000119788241818, -0.0601322254139098, -0.0772712391554374,
                    -0.0095314181062537,  0.0300423336075638, -0.0000721953861846, -0.0827458970287249,],
                [  0.0001526818320986,  0.0003468621763928,  0.0005366761089915,  0.0002470804100643,
                    0.0001451362932228,  0.0000858226782223,  0.0000208458534755,  0.0000190749087320,
                    0.0000068852114693,  0.0000036738200741,  0.0000079794466874,  0.0000070391423244,
                    0.0000541313124773,  0.1046333957067665,  0.0001276842669091,  0.0174917752480656,
                    0.0039051693410350,  0.0005564617531127,  0.0772712391554374,  0.1512035062489979,
                    0.0046440923708791,  0.0000598076019691, -0.0609227452323463,  0.0018027368429374,],
                [  0.0001154423139505,  0.0001043077289742,  0.0002274485318279,  0.0006495050298993,
                    0.0007415726726966,  0.0001959679960649,  0.0000138527892794,  0.0001277384515417,
                    0.0000163482667826,  0.0000078635412579,  0.0000019438485986,  0.0000004826777277,
                    0.0000155877036005,  0.0117728158028913,  0.0005529620800848,  0.1527163495247426,
                    0.0011730555326683, -0.0000149958674645,  0.0095314181062537, -0.0046440923708791,
                    0.1732512195825845,  0.0127751234187038, -0.0114648857839673, -0.0013645924126505,],
                [  0.0000024508648260,  0.0000000657493463, -0.0000009871633163, -0.0000006411307097,
                    0.0000239792209253,  0.0000121785700433,  0.0000006666359807,  0.0000210294441122,
                    -0.0000001795403379,  0.0000010674128946, -0.0000000134848620, -0.0000000973267055,
                    0.0000000172481442, -0.0000139524021639,  0.0003109237961683,  0.0013847466015856,
                    -0.0000166783959649, -0.0000002435467525, -0.0300423336075638, -0.0000598076019691,
                    -0.0127751234187038, -0.0417027480121392, -0.0000009162467434, -0.0005488996903728,],
                [  0.0000063770696233,  0.0000179284643206,  0.0000385487653202,  0.0000140629181993,
                    0.0000064273393116,  0.0000036127623565,  0.0000013737522377,  0.0000013543034523,
                    0.0000007061639661,  0.0000002332042293,  0.0000007238107672,  0.0000014797503788,
                    0.0000008854999111,  0.0000960136828089,  0.0000024082365292,  0.0000339711255500,
                    0.0132687023942173,  0.0000175628875156,  0.0000721953861846,  0.0609227452323463,
                    0.0114648857839673,  0.0000009162467434,  0.0862073601982656,  0.0002342454183290,],
                [  0.0000141815992975,  0.0000158124731105,  0.0000608293660459,  0.0002475611212915,
                    0.0001612509914521,  0.0000268471094570,  0.0000023936754239,  0.0000572102866824,
                    0.0000197363295590,  0.0000017042260514,  0.0000005314637414,  0.0000011748580832,
                    0.0000011557578086,  0.0000810226454230,  0.0000243823715493,  0.0004535828154316,
                    0.0001106491212681,  0.0000001356203790,  0.0827458970287249, -0.0018027368429374,
                    0.0013645924126505,  0.0005488996903728, -0.0002342454183290,  0.0839025687025375,],
            ],
            [
                [ -0.2181117955513003, -0.0032358486238398, -0.1037627730666103, -0.0124032876446235,
                    -0.0991211674782609, -0.0026282705738550,  0.0018826875495128, -0.0002818541864616,
                    -0.0000240799747570,  0.0005213492732763, -0.0014363215443731, -0.0000543278270102,
                    0.0000408192015670,  0.0011332381736146,  0.0001097304611439,  0.0005894195177057,
                    0.0003565237802625,  0.0000103034923627,  0.0000897595641230,  0.0000581805285993,
                    0.0000394444152340,  0.0000024693158873,  0.0000013309118385,  0.0000008791833634,],
                [  0.0032358486238398,  0.0229597343673100, -0.0051807927530089, -0.0678006428426892,
                    -0.0062417652242805,  0.0108037997473958,  0.0782757960448526, -0.0000429343251582,
                    -0.0000641508313685,  0.0000202016354160,  0.0149124943088313, -0.0072365728493913,
                    0.0000186669143288,  0.0005659268487505,  0.0000213143877626,  0.0001623013637072,
                    0.0010263178984502,  0.0000341374533527,  0.0000603260897778,  0.0002813925044627,
                    0.0000929480379090,  0.0000018082311161,  0.0000081012367540,  0.0000052118664996,],
                [  0.1037627730666103,  0.0051807927530089,  0.1089390913320539, -0.0020569918764693,
                    0.0183251480827652,  0.0077150644917947,  0.0003807787433971, -0.0000158892434229,
                    -0.0084469784735104,  0.0000149106990091,  0.0060847579777971, -0.0245660361999966,
                    0.0000056132653834,  0.0001765221128410,  0.0000132444770807,  0.0001096048889809,
                    0.0005639626291028,  0.0000171647591420,  0.0001307371641331,  0.0009105345929745,
                    0.0005314402685561,  0.0000042243965946,  0.0000353809223238,  0.0000623318339579,],
                [  0.0124032876446235,  0.0678006428426892,  0.0020569918764693,  0.1161655970700526,
                    0.0041629574768013,  0.0594998641083150,  0.0000905674906495,  0.0110980436661914,
                    -0.0431491415012045,  0.0000475815556995,  0.0000337202680637, -0.0004565807587414,
                    0.0000028831440650,  0.0000877228181310,  0.0000197798735864,  0.0001493473894774,
                    0.0001369815387912,  0.0000040448817231,  0.0004056923136753,  0.0003572603333520,
                    0.0011562494839654,  0.0000149960687328,  0.0000122516835513,  0.0002304528714451,],
                [  0.0991211674782609,  0.0062417652242805, -0.0183251480827652, -0.0041629574768013,
                    0.0931420030096988,  0.0067542709798866,  0.0003713180890575, -0.0007224047749417,
                    -0.0089587818608977,  0.0097075863180350,  0.0000082541538967, -0.0000205633034135,
                    0.0000049610822120,  0.0001583840423200,  0.0001121462570855,  0.0006420579926949,
                    0.0000891441038621,  0.0000026076948961,  0.0012801299145415,  0.0001111754225286,
                    0.0005983106945120,  0.0000559252150713,  0.0000032210330756,  0.0000694328123012,],
                [  0.0026282705738550, -0.0108037997473958, -0.0077150644917947, -0.0594998641083150,
                    -0.0067542709798866, -0.0553432327234411,  0.0515375078079294, -0.0540050046808484,
                    -0.0000540838167608,  0.0269840297088568,  0.0000012303951187, -0.0000106787053386,
                    0.0000120772654248,  0.0003768687033828,  0.0002891322317261,  0.0011078895793809,
                    0.0000899070728013,  0.0000025813941956,  0.0003416070706110,  0.0000359175670897,
                    0.0000766548941402,  0.0000112089628722,  0.0000009252476745,  0.0000037253318396,],
                [ -0.0018826875495128, -0.0782757960448526, -0.0003807787433971, -0.0000905674906495,
                    -0.0003713180890575, -0.0515375078079294, -0.1325454717190336, -0.0000158209724035,
                    -0.0000017076386812, -0.0001724320856367, -0.0002017254437867, -0.0000036472486111,
                    0.0000227220334090,  0.0002170957011676,  0.0000289743100657,  0.0000690722547833,
                    0.0000395451330514,  0.0000022908717061,  0.0000050658993809,  0.0000029108377882,
                    0.0000009313838899,  0.0000001834058430,  0.0000000444591845, -0.0000003188947853,],
                [  0.0002818541864616,  0.0000429343251582,  0.0000158892434229, -0.0110980436661914,
                    0.0007224047749417,  0.0540050046808484,  0.0000158209724035,  0.0448106223768628,
                    -0.0002169412395667,  0.0003855023514349,  0.0000006119455836, -0.0000005178868197,
                    0.0000010621665482,  0.0000203150643985,  0.0000357966296429,  0.0001061560665823,
                    0.0000107380529510,  0.0000005206210059,  0.0003006987066250,  0.0000143946183049,
                    0.0001006180693945,  0.0000388698471319,  0.0000006998476294,  0.0000262329989713,],
                [  0.0000240799747570,  0.0000641508313685,  0.0084469784735104,  0.0431491415012045,
                    0.0089587818608977,  0.0000540838167608,  0.0000017076386812,  0.0002169412395667,
                    0.0610666942869784,  0.0000007056977482,  0.0000005731391590,  0.0000091727722000,
                    0.0000001935729936,  0.0000037471446159,  0.0000012705415777,  0.0000059607330479,
                    0.0000058929196362,  0.0000002757144202,  0.0000164317935337,  0.0000161538338928,
                    0.0000554675683430,  0.0000009903349505,  0.0000009305047430,  0.0000330626793699,],
                [ -0.0005213492732763, -0.0000202016354160, -0.0000149106990091, -0.0000475815556995,
                    -0.0097075863180350, -0.0269840297088568,  0.0001724320856367, -0.0003855023514349,
                    -0.0000007056977482, -0.0374040352590110, -0.0000000918777262, -0.0000002174763645,
                    0.0000007276308313,  0.0000134410779656,  0.0000326225406006,  0.0000432693387404,
                    0.0000027888530380,  0.0000001301041416,  0.0000095028949606,  0.0000009530951312,
                    0.0000016998520720,  0.0000004876001998,  0.0000000343654301,  0.0000000518958075,],
                [  0.0014363215443731, -0.0149124943088313, -0.0060847579777971, -0.0000337202680637,
                    -0.0000082541538967, -0.0000012303951187,  0.0002017254437867, -0.0000006119455836,
                    -0.0000005731391590,  0.0000000918777262, -0.0193563783438492, -0.0000204857329070,
                    0.0000009313263772,  0.0000161874812046,  0.0000008862062244,  0.0000039098544343,
                    0.0000330042304769,  0.0000021882716981,  0.0000013421781807,  0.0000067666551330,
                    0.0000018821374902,  0.0000000634032400,  0.0000003083748827,  0.0000001405922798,],
                [  0.0000543278270102,  0.0072365728493913,  0.0245660361999966,  0.0004565807587414,
                    0.0000205633034135,  0.0000106787053386,  0.0000036472486111,  0.0000005178868197,
                    -0.0000091727722000,  0.0000002174763645,  0.0000204857329070,  0.0324490707269833,
                    0.0000002871004158,  0.0000055624231420,  0.0000006550670603,  0.0000032806804779,
                    0.0000191716653806,  0.0000009965071551,  0.0000036921912781,  0.0000329527049514,
                    0.0000155181355609,  0.0000001928601268,  0.0000025495502699,  0.0000037566247707,],
                [ -0.0000408192015670, -0.0000186669143288, -0.0000056132653834, -0.0000028831440650,
                    -0.0000049610822120, -0.0000120772654248, -0.0000227220334090, -0.0000010621665482,
                    -0.0000001935729936, -0.0000007276308313, -0.0000009313263772, -0.0000002871004158,
                    -0.0534272596630598, -0.0408863367771472, -0.0001093034646589, -0.0053592482076113,
                    -0.0068295297301836, -0.0000132844073559, -0.0000433054659362, -0.0000499860112193,
                    -0.0000223851897481, -0.0000005792354252, -0.0000006984928233, -0.0000016579773946,],
                [ -0.0011332381736146, -0.0005659268487505, -0.0001765221128410, -0.0000877228181310,
                    -0.0001583840423200, -0.0003768687033828, -0.0002170957011676, -0.0000203150643985,
                    -0.0000037471446159, -0.0000134410779656, -0.0000161874812046, -0.0000055624231420,
                    0.0408863367771472, -0.1276131770952015,  0.0078489527697249, -0.0021176829202547,
                    -0.0033696840985601, -0.0017161590238437, -0.0670550773041004, -0.0822301410099402,
                    -0.0168538188811957, -0.0000502541684294, -0.0000646934299189, -0.0001159442142961,],
                [ -0.0001097304611439, -0.0000213143877626, -0.0000132444770807, -0.0000197798735864,
                    -0.0001121462570855, -0.0002891322317261, -0.0000289743100657, -0.0000357966296429,
                    -0.0000012705415777, -0.0000326225406006, -0.0000008862062244, -0.0000006550670603,
                    0.0001093034646589, -0.0078489527697249, -0.0745584398707476, -0.0011816042615098,
                    -0.0001221676194089, -0.0000006147817741, -0.0640063769532858, -0.0000572274841355,
                    -0.0003624352921267, -0.0004027496073870, -0.0000010806857898, -0.0000189808967072,],
                [ -0.0005894195177057, -0.0001623013637072, -0.0001096048889809, -0.0001493473894774,
                    -0.0006420579926949, -0.0011078895793809, -0.0000690722547833, -0.0001061560665823,
                    -0.0000059607330479, -0.0000432693387404, -0.0000039098544343, -0.0000032806804779,
                    0.0053592482076113,  0.0021176829202547,  0.0011816042615098, -0.1532341856922934,
                    -0.0159641966860709,  0.0000012789928724, -0.0069412554820620, -0.0078598254789731,
                    -0.1188539461767466, -0.0088461224956444, -0.0000152786945355, -0.0004211054004960,],
                [ -0.0003565237802625, -0.0010263178984502, -0.0005639626291028, -0.0001369815387912,
                    -0.0000891441038621, -0.0000899070728013, -0.0000395451330514, -0.0000107380529510,
                    -0.0000058929196362, -0.0000027888530380, -0.0000330042304769, -0.0000191716653806,
                    0.0068295297301836,  0.0033696840985601,  0.0001221676194089,  0.0159641966860709,
                    -0.0889688062624668,  0.0150731840266832, -0.0048318431360915, -0.0056705775741889,
                    -0.1058144858922458, -0.0000094363355298, -0.0112345162870093, -0.0003927313205040,],
                [ -0.0000103034923627, -0.0000341374533527, -0.0000171647591420, -0.0000040448817231,
                    -0.0000026076948961, -0.0000025813941956, -0.0000022908717061, -0.0000005206210059,
                    -0.0000002757144202, -0.0000001301041416, -0.0000021882716981, -0.0000009965071551,
                    0.0000132844073559,  0.0017161590238437,  0.0000006147817741, -0.0000012789928724,
                    -0.0150731840266832, -0.0184457335897524, -0.0000066486467509, -0.0049400193823464,
                    -0.0000479140296443, -0.0000001366873200, -0.0000259354696492, -0.0000034328016604,],
                [ -0.0000897595641230, -0.0000603260897778, -0.0001307371641331, -0.0004056923136753,
                    -0.0012801299145415, -0.0003416070706110, -0.0000050658993809, -0.0003006987066250,
                    -0.0000164317935337, -0.0000095028949606, -0.0000013421781807, -0.0000036921912781,
                    0.0000433054659362,  0.0670550773041004,  0.0640063769532858,  0.0069412554820620,
                    0.0048318431360915,  0.0000066486467509,  0.0469223471705093, -0.0088308515838499,
                    -0.0042961075954100, -0.0175561981670975, -0.0000164774958768, -0.0626175391946623,],
                [ -0.0000581805285993, -0.0002813925044627, -0.0009105345929745, -0.0003572603333520,
                    -0.0001111754225286, -0.0000359175670897, -0.0000029108377882, -0.0000143946183049,
                    -0.0000161538338928, -0.0000009530951312, -0.0000067666551330, -0.0000329527049514,
                    0.0000499860112193,  0.0822301410099402,  0.0000572274841355,  0.0078598254789731,
                    0.0056705775741889,  0.0049400193823464,  0.0088308515838499,  0.0247183479123887,
                    -0.0026814278391081, -0.0000014950038388, -0.0274663425996501, -0.0529424224754593,],
                [ -0.0000394444152340, -0.0000929480379090, -0.0005314402685561, -0.0011562494839654,
                    -0.0005983106945120, -0.0000766548941402, -0.0000009313838899, -0.0001006180693945,
                    -0.0000554675683430, -0.0000016998520720, -0.0000018821374902, -0.0000155181355609,
                    0.0000223851897481,  0.0168538188811957,  0.0003624352921267,  0.1188539461767466,
                    0.1058144858922458,  0.0000479140296443,  0.0042961075954100,  0.0026814278391081,
                    0.2459248383792414,  0.0021860482042890, -0.0005716010594894, -0.0019509647207160,],
                [ -0.0000024693158873, -0.0000018082311161, -0.0000042243965946, -0.0000149960687328,
                    -0.0000559252150713, -0.0000112089628722, -0.0000001834058430, -0.0000388698471319,
                    -0.0000009903349505, -0.0000004876001998, -0.0000000634032400, -0.0000001928601268,
                    0.0000005792354252,  0.0000502541684294,  0.0004027496073870,  0.0088461224956444,
                    0.0000094363355298,  0.0000001366873200,  0.0175561981670975,  0.0000014950038388,
                    -0.0021860482042890,  0.0242833244119462, -0.0000001038392163, -0.0002660756034545,],
                [ -0.0000013309118385, -0.0000081012367540, -0.0000353809223238, -0.0000122516835513,
                    -0.0000032210330756, -0.0000009252476745, -0.0000000444591845, -0.0000006998476294,
                    -0.0000009305047430, -0.0000000343654301, -0.0000003083748827, -0.0000025495502699,
                    0.0000006984928233,  0.0000646934299189,  0.0000010806857898,  0.0000152786945355,
                    0.0112345162870093,  0.0000259354696492,  0.0000164774958768,  0.0274663425996501,
                    0.0005716010594894,  0.0000001038392163,  0.0391571907481374, -0.0001737591684641,],
                [ -0.0000008791833634, -0.0000052118664996, -0.0000623318339579, -0.0002304528714451,
                    -0.0000694328123012, -0.0000037253318396,  0.0000003188947853, -0.0000262329989713,
                    -0.0000330626793699, -0.0000000518958075, -0.0000001405922798, -0.0000037566247707,
                    0.0000016579773946,  0.0001159442142961,  0.0000189808967072,  0.0004211054004960,
                    0.0003927313205040,  0.0000034328016604,  0.0626175391946623,  0.0529424224754593,
                    0.0019509647207160,  0.0002660756034545,  0.0001737591684641,  0.1184696539779938,],
            ],
        ];

        let mut dcndr_ref: Array3<f64> = Array::zeros((3, 24, 24));
        for i in 0..3 {
            for j in 0..24 {
                for k in 0..24 {
                    dcndr_ref[[i, j, k]] = dcndr_ref_array[i][j][k];
                }
            }
        }
        let dcndr_ref: Array3<f64> = dcndr_ref.reversed_axes();

        let dcndl_ref_array: [[[f64; 24]; 3]; 3] = [
            [
                [ -0.8114290790228034, -0.9951567458301317, -0.6172046783359871, -0.8063698960676646,
                    -1.2474864715467009, -1.0238806635628763, -0.3582345650881130, -0.5467883786367606,
                    -0.1049192768895860, -0.0569476562988663, -0.1600341870254730, -0.0349060663899866,
                    -0.0889116516098012, -0.8679947815594012, -0.2953052406681196, -0.4923954803118562,
                    -1.2155549437043056, -0.1412528947995049, -0.8649768648532368, -0.6303737506999605,
                    -0.8621953372050973, -0.1745662461723107, -0.0474942196016326, -0.3610346717400618,],
                [  0.1449341906115493, -0.2660873527008913, -0.4075970972172012, -0.0769631815983035,
                    -0.4170673546710418, -0.2266158574819024,  0.0866191990803533, -0.1814810405469184,
                    0.0463610448213399, -0.0585158429855324, -0.0605553136417090, -0.0435808534515979,
                    0.0393523003299225, -0.1399821578677761, -0.2136877147969645, -0.2697747586525671,
                    -0.4535439253402648, -0.0704996839775957, -0.1591643133937698, -0.1819270137424132,
                    0.1151080656060897, -0.0771380134798589, -0.0486313034038728,  0.0616596578466468,],
                [  0.4947961136904235,  0.3324820799050152,  0.0500146008160023,  0.3585603908886431,
                    0.3737713928247688,  0.3764796643128845,  0.2355859668920753,  0.1675869141154352,
                    0.0828343193486308, -0.0078675334558038,  0.0441679160469233, -0.0097274081199744,
                    0.0766262356616920,  0.4181506522063330,  0.0397200152112556,  0.1106333836923951,
                    0.4313883806168227,  0.0396654732971387,  0.3988522065820911,  0.2523368603819771,
                    0.5651427651090694,  0.0548288023452982, -0.0023897715060963,  0.2474083304331291,],
            ],
            [
                [  0.1449341906115493, -0.2660873527008913, -0.4075970972172012, -0.0769631815983034,
                    -0.4170673546710418, -0.2266158574819024,  0.0866191990803533, -0.1814810405469183,
                    0.0463610448213399, -0.0585158429855324, -0.0605553136417090, -0.0435808534515979,
                    0.0393523003299225, -0.1399821578677761, -0.2136877147969645, -0.2697747586525671,
                    -0.4535439253402648, -0.0704996839775957, -0.1591643133937698, -0.1819270137424132,
                    0.1151080656060897, -0.0771380134798589, -0.0486313034038728,  0.0616596578466468,],
                [ -0.6256318965507605, -0.7747615683250580, -1.1711313061239379, -0.6385136584575779,
                    -0.6154209867672162, -0.7948683298914857, -0.3949589070677567, -0.2493014328490643,
                    -0.0813126775144828, -0.1727190010364273, -0.0459572672176493, -0.1443389991354490,
                    -0.0567947445168935, -0.7915313343889220, -0.5893379091798588, -1.0979608463086121,
                    -0.6093681247723115, -0.0565407377944471, -0.8738133585232453, -0.8299142085425998,
                    -0.6719918800626754, -0.0694882513192605, -0.1791550563168648, -0.2853560416499747,],
                [ -0.4522762960331378, -0.3392966378431679, -0.5168052714020275, -0.3513516474177080,
                    -0.1540982186586095, -0.3676608382052822, -0.2891909291524707, -0.0593143071062257,
                    -0.0745052695838420, -0.0776972935057898,  0.0027480017429322, -0.0678793330043580,
                    -0.0580100230586194, -0.3949615908974998, -0.2369745915739727, -0.5102215891219817,
                    -0.0948380661106118,  0.0070975000932128, -0.4343149784464942, -0.3930895633364624,
                    -0.4654795946421723,  0.0032803563689929, -0.0817258957374830, -0.2084296520033442,],
            ],
            [
                [  0.4947961136904234,  0.3324820799050151,  0.0500146008160023,  0.3585603908886431,
                    0.3737713928247687,  0.3764796643128845,  0.2355859668920753,  0.1675869141154352,
                    0.0828343193486308, -0.0078675334558038,  0.0441679160469233, -0.0097274081199744,
                    0.0766262356616920,  0.4181506522063329,  0.0397200152112556,  0.1106333836923951,
                    0.4313883806168226,  0.0396654732971387,  0.3988522065820910,  0.2523368603819770,
                    0.5651427651090694,  0.0548288023452982, -0.0023897715060963,  0.2474083304331291,],
                [ -0.4522762960331378, -0.3392966378431678, -0.5168052714020275, -0.3513516474177080,
                    -0.1540982186586095, -0.3676608382052822, -0.2891909291524706, -0.0593143071062257,
                    -0.0745052695838420, -0.0776972935057897,  0.0027480017429322, -0.0678793330043580,
                    -0.0580100230586194, -0.3949615908974999, -0.2369745915739727, -0.5102215891219818,
                    -0.0948380661106118,  0.0070975000932128, -0.4343149784464942, -0.3930895633364624,
                    -0.4654795946421723,  0.0032803563689929, -0.0817258957374830, -0.2084296520033442,],
                [ -0.5602818369760793, -0.4046997928342750, -0.3720741664277346, -0.4273362950815447,
                    -0.3158412209649737, -0.4451741126922920, -0.3072607308395301, -0.1290345114678739,
                    -0.0905401506014888, -0.0458056154822101, -0.0217252975792571, -0.0382590863270331,
                    -0.0820337552094644, -0.5159159977954626, -0.1754618689406334, -0.4068811596819082,
                    -0.3345515933950585, -0.0196848195314481, -0.5272416791150500, -0.4088759117368641,
                    -0.6452570267197038, -0.0316058999384498, -0.0499253822430448, -0.2796501931310250,],
            ],
        ];

        let mut dcndl_ref: Array3<f64> = Array::zeros((3, 3, 24));
        for i in 0..3 {
            for j in 0..3 {
                for k in 0..24 {
                    dcndl_ref[[i, j, k]] = dcndl_ref_array[i][j][k];
                }
            }
        }
        let dcndl_ref: Array3<f64> = dcndl_ref.reversed_axes();

        assert!(cn.abs_diff_eq(&cn_ref, 1e-14));
        assert!(dcndr.abs_diff_eq(&dcndr_ref, 1e-14));
        assert!(dcndl.abs_diff_eq(&dcndl_ref, 1e-14));
    }
}